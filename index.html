<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>Portada - Back to Black</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Domine:wght@400..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css">
    <script>
        (() => {
            const saved = localStorage.getItem('theme');
            const theme = saved ? saved : 'dark';
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo-container">
                <img class="logo-svg" src="assets/logo.svg" alt="Together logo" width="240"/>
                <h1>Together</h1>
            </div>
            <button id="theme-toggle" class="theme-toggle" aria-label="Cambiar tema">
                <img id="icon-moon" src="assets/icon-moon.svg" alt="Tema oscuro" width="24" height="24" style="display: none;" />
                <img id="icon-sun" src="assets/icon-sun.svg" alt="Tema claro" width="24" height="24" style="display: block;" />
            </button>
        </div>
    </header>
    
    <main>

        <section class="hero">
            <h2>Haciendo más fácil nuestro día a día.</h2>
            <p class="hero-text">Juntamos <kbd>herramientas</kbd> + <kbd>IA</kbd> + <kbd>colaboración</kbd> para que hacer cosas sea más sencillo y efectivo.</p>
            <a href="#" class="btn-cta" id="cta-button">Acceso anticipado a la beta</a>
        </section>

        <div class="bento-grid">

            <article class="bento-item bento-item-large">
                <div class="bento-header">
                    <div class="header-content">
                        <h2>¿Qué queremos mejorar?</h2>
                        <span class="chevron-icon"></span>
                    </div>
                </div>
                <div class="bento-content">
                    <p>Puede que ya tengas tu calendario, tu app para las tareas y tu otra app para poder escribir notas y por supuesto tienes tus conversaciones en tu mensajería instantánea favorita.</p>
                    <p>Si ahora quieres organizar un plan sencillo todo lo que tienes que hacer es coordinar a varias personas, que usan varias herramientas, que no se conectan entre sí, mientras lo discutís en una app diseñada para comunicarse pero no para colaborar.</p>
                    <p>Traemos una alternativa que ayuda a que obtengamos mejores resultados en la organización de tu día a día.</p>
                </div>
            </article>
            
            <article class="bento-item">
                <div class="bento-header">
                    <div class="header-content">
                        <h2>No te adaptes al producto</h2>
                        <span class="chevron-icon"></span>
                    </div>
                </div>
                <div class="bento-content">
                    <p>Hasta ahora tenías que encontrar productos que encajaran exactamente con las necesidades que tenías.</p>
                    <p>Trabajamos para que sea al revés, buscamos la forma de adaptarnos a ti y tus circunstancias. Tengas un día a día muy complejo o muy sencillo, queremos que el producto sea quien se tenga adaptar.</p>
                </div>
            </article> 
            
            <article class="bento-item bento-item-tall">
                <div class="bento-header">
                    <div class="header-content">
                        <h2>La colaboración es el superpoder de los humanos</h2>
                        <span class="chevron-icon"></span>
                    </div>
                </div>
                <div class="bento-content">
                    <p>Esforzarnos juntos es lo que nos ha permitido crear todas las cosas increíbles que existen hoy en día.</p>
                    <p>Las herramientas de gestión del día a día de las empresas giran alrededor de la colaboración, y mientras faltaba quien hiciera lo mismo para nuestra vida personal.</p>
                </div>
            </article> 
            
            <article class="bento-item bento-item-wide">
                <div class="bento-header">
                    <div class="header-content">
                        <h2>La IA a tus pies</h2>
                        <span class="chevron-icon"></span>
                    </div>
                </div>
                <div class="bento-content">
                    <p>La IA tiene que estar a tu servicio y no al reves. Puedes usarla o no de forma opcional y nunca va a estar encima de tus datos, solo consultará los que necesita si quieres pedirle algo.</p>
                    <p>Nos esforzamos por usar los mejores modelos disponibles en cada momento de proveedores como OpenAI, Anthropic y Perplexity.</p>
                </div>
            </article>

            <article class="bento-item">
                <div class="bento-header">
                    <div class="header-content">
                        <h2>Versión gratuita para siempre</h2>
                        <span class="chevron-icon"></span>
                    </div>
                </div>
                <div class="bento-content">
                    <p>Usar together es hoy totalmente gratis y más adelante sólo habrá que pagar por el uso de la IA, características nuevas y para exceder límites de uso que están sin fijar.</p>
                </div>
            </article>
        </div>
        <section class="product-showcase">
            <button class="showcase-btn prev" id="showcasePrev" aria-label="Slide previa">&#10094;</button>
            <div class="showcase-track">
                <div class="showcase-slide active">
                    <img src="assets/homeShowcase/screen-project-1.png" alt="Captura de proyectos" class="product-image" />
                    <div class="product-copy" style="max-width: 90%; width: 400px;">
                        <h2>A la medida de vuestra realidad</h2>
                        <p>Sólo tú y los tuyos sabéis qué es lo mejor para gestionar vuestra vida. Es nuestra misión hacer una solución que te permita tenerlo fácilmente.</p>
                    </div>
                </div>
                <div class="showcase-slide">
                    <img src="assets/homeShowcase/screen-chat-2.png" alt="Captura de chat" class="product-image" />
                    <div class="product-copy" style="max-width: 90%; width: 400px;">
                        <h2>Comunicación sin ruido</h2>
                        <p>Todo está donde debe estar. Sin notificaciones innecesarias ni conversaciones perdidas. La comunicación directa y clara que siempre has deseado.</p>
                    </div>
                </div>
                <div class="showcase-slide">
                    <img src="assets/homeShowcase/screen-cal-3.png" alt="Captura de calendario" class="product-image" />
                    <div class="product-copy" style="max-width: 90%; width: 400px;">
                        <h2>Todo en su lugar</h2>
                        <p>Sin dudas sobre dónde encontrar esa información importante. Todos saben exactamente dónde está cada cosa, facilitando la organización diaria.</p>
                    </div>
                </div>
            </div>
            <button class="showcase-btn next" id="showcaseNext" aria-label="Slide siguiente">&#10095;</button>
        </section>

        <section class="principles-card">
            <div>
                <h2 class="principles-heading">Creamos Together para cuidar, no para retener. Para dar foco, y no distracción. Para traer claridad, y no ansiedad.</h2>
                <p class="hero-text">El sueño siempre ha sido crear algo que usaríamos con las personas que más nos importan y todas nuestras decisiones de diseño tienen eso en cuenta.</p>
                <p class="hero-text firma">- Los fundadores y el equipo de together</p>
            </div>
        </section>

        <!-- spaces-carousel removed -->

    </main>

    <footer>
        <div class="footer-content">
            <p class="copyright">&copy; 2025 Together Solutions S.L.</p>
            <div class="footer-links">
                <a href="legal.html" class="footer-link">Aviso legal</a>
                <span class="footer-separator">·</span>
                <a href="privacy.html" class="footer-link">Política de privacidad</a>
                <span class="footer-separator">·</span>
                <a href="humans.html" class="footer-link">Quién está detrás</a>
            </div>
        </div>
    </footer>

    <!-- Phone Overlay -->
    <div id="phone-overlay" class="phone-overlay">
        <div class="overlay-content">
            <button class="close-overlay" id="close-overlay">&times;</button>
            <h2>Acceso anticipado</h2>
            <p>Introduce tu número de teléfono y te enviaremos un SMS con el enlace para acceder a la beta.</p>
            
            <form id="phone-form" class="phone-form">
                <div class="phone-input-container">
                    <input type="tel" id="phone" name="phone" class="phone-input" required>
                </div>
                <div class="form-feedback" id="form-feedback"></div>
                <div class="os-selection hidden" id="os-selection">
                    <p class="os-instruction">Selecciona tu sistema operativo para recibir el enlace adecuado:</p>
                    <div class="os-buttons">
                        <button type="button" id="android-btn" class="btn-cta os-btn">Android</button>
                        <button type="button" id="iphone-btn" class="btn-cta os-btn">iPhone</button>
                    </div>
                </div>
            </form>
            
            <div id="countdown-container" class="countdown-container hidden">
                <p>Podrás solicitar otro SMS en <span id="countdown">59</span> segundos</p>
            </div>
            
            <div id="done-container" class="done-container hidden">
                <button type="button" id="done-btn" class="btn-cta done-btn">Cerrar</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <script>
        const themeToggle = document.getElementById('theme-toggle');
        const iconMoon = document.getElementById('icon-moon');
        const iconSun = document.getElementById('icon-sun');
        
        // Check for saved theme preference or use system preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.documentElement.setAttribute('data-theme', savedTheme);
            if (savedTheme === 'dark') {
                iconMoon.style.display = 'none';
                iconSun.style.display = 'block';
            } else {
                iconMoon.style.display = 'block';
                iconSun.style.display = 'none';
            }
        }

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            if (newTheme === 'dark') {
                iconMoon.style.display = 'none';
                iconSun.style.display = 'block';
            } else {
                iconMoon.style.display = 'block';
                iconSun.style.display = 'none';
            }
        });

        // -------- Carousel logic --------
        const track = document.querySelector('#hierarchyCarousel .carousel-track');
        if (track) {
            const slides = Array.from(track.children);
            const prevBtn = document.getElementById('prevSlide');
            const nextBtn = document.getElementById('nextSlide');
            let current = 0;
            function updateCarousel() {
                track.style.transform = `translateX(-${current * 100}%)`;
            }
            prevBtn?.addEventListener('click', () => {
                current = (current - 1 + slides.length) % slides.length;
                updateCarousel();
            });
            nextBtn?.addEventListener('click', () => {
                current = (current + 1) % slides.length;
                updateCarousel();
            });
            updateCarousel();
        }

        // ----- Showcase carousel (infinite) -----
        const showcaseTrack = document.querySelector('.showcase-track');
        const showcaseSlides = document.querySelectorAll('.showcase-slide');
        const prevShowcase = document.getElementById('showcasePrev');
        const nextShowcase = document.getElementById('showcaseNext');
        const productShowcase = document.querySelector('.product-showcase');
        let showcaseCurrent = 0; // Start with the first slide
        
        // Variables para gestionar el swipe
        let touchStartX = 0;
        let touchEndX = 0;
        let isDragging = false;
        let startTranslateX = 0;
        let currentTranslateX = 0;

        function setShowcaseActive(index) {
            showcaseSlides.forEach(slide => slide.classList.remove('active'));
            showcaseSlides[index].classList.add('active');
        }

        function updateShowcase() {
            setShowcaseActive(showcaseCurrent);
            const slideWidth = showcaseSlides[0].offsetWidth; // Get width of first slide
            const gap = parseInt(window.getComputedStyle(showcaseTrack).columnGap || 16);
            const containerWidth = productShowcase.offsetWidth;
            const totalSlides = showcaseSlides.length;
            const trackWidth = (totalSlides * slideWidth) + (gap * (totalSlides - 1));
            
            let scrollPosition;
            
            // Detectar si estamos en versión móvil o escritorio
            const isMobile = window.innerWidth < 768;
            
            if (!isMobile) {
                // VERSIÓN ESCRITORIO
                if (trackWidth <= containerWidth) {
                    // Si el ancho total del track es menor que el contenedor, centramos el contenido
                    scrollPosition = (containerWidth - trackWidth) / 2;
                } else {
                    // Alinear el primer slide a la izquierda cuando está activo
                    if (showcaseCurrent === 0) {
                        scrollPosition = 0;
                    } 
                    // Alinear el último slide a la derecha cuando está activo
                    else if (showcaseCurrent === totalSlides - 1) {
                        scrollPosition = -(trackWidth - containerWidth);
                    } 
                    // Para el resto de slides, calcular la posición para centrarlos
                    else {
                        // Calculamos cuánto espacio debe haber en cada lado para centrar el slide actual
                        const slideCenter = (showcaseCurrent * (slideWidth + gap)) + (slideWidth / 2);
                        const containerCenter = containerWidth / 2;
                        
                        // Calculamos la posición para centrar perfectamente el slide actual
                        scrollPosition = containerCenter - slideCenter;
                        
                        // Limitar el desplazamiento para que no exceda los límites
                        const maxScroll = -(trackWidth - containerWidth);
                        scrollPosition = Math.max(maxScroll, Math.min(0, scrollPosition));
                    }
                }
            } else {
                // VERSIÓN MÓVIL: Centrar perfectamente todas las diapositivas
                
                // Consideramos el padding del track (0.5rem a cada lado = 1rem total)
                const trackPadding = 16; // Equivalente a 1rem (0.5rem * 2)
                
                // Obtener el ancho efectivo del contenedor (quitando el padding)
                const effectiveContainerWidth = containerWidth - trackPadding;
                
                // Calcular el centro del contenedor (considerando el padding)
                const containerCenter = effectiveContainerWidth / 2 + (trackPadding / 2);
                
                // Calcular el centro de la diapositiva actual (considerando gap)
                const slideCenter = (showcaseCurrent * (slideWidth + gap)) + (slideWidth / 2);
                
                // Calcular el desplazamiento necesario para centrar la diapositiva
                scrollPosition = containerCenter - slideCenter;
                
                // Ajuste fino adicional para compensar cualquier otro desplazamiento visual
                // basado en la estructura específica del DOM
                const fineAdjustment = 8; // Valor basado en pruebas visuales
                scrollPosition -= fineAdjustment;
            }
            
            showcaseTrack.style.transform = `translateX(${scrollPosition}px)`;
            currentTranslateX = scrollPosition;
        }
        
        // Funciones para gestionar eventos táctiles
        function handleTouchStart(e) {
            touchStartX = e.touches[0].clientX;
            isDragging = true;
            startTranslateX = currentTranslateX;
            showcaseTrack.style.transition = 'none'; // Desactivar transición durante el arrastre
        }
        
        function handleTouchMove(e) {
            if (!isDragging) return;
            touchEndX = e.touches[0].clientX;
            const diffX = touchEndX - touchStartX;
            currentTranslateX = startTranslateX + diffX;
            showcaseTrack.style.transform = `translateX(${currentTranslateX}px)`;
            // Ya no prevenimos el desplazamiento vertical
        }
        
        function handleTouchEnd() {
            if (!isDragging) return;
            isDragging = false;
            showcaseTrack.style.transition = 'transform 0.6s ease';
            
            const moveDistance = touchEndX - touchStartX;
            const threshold = window.innerWidth * 0.15; // 15% del ancho de la pantalla
            
            if (moveDistance < -threshold && showcaseCurrent < showcaseSlides.length - 1) {
                // Swipe a la izquierda -> siguiente slide
                showcaseCurrent++;
            } else if (moveDistance > threshold && showcaseCurrent > 0) {
                // Swipe a la derecha -> slide anterior
                showcaseCurrent--;
            }
            
            updateShowcase();
        }

        prevShowcase.addEventListener('click', () => {
            showcaseCurrent = (showcaseCurrent - 1 + showcaseSlides.length) % showcaseSlides.length;
            updateShowcase();
        });

        nextShowcase.addEventListener('click', () => {
            showcaseCurrent = (showcaseCurrent + 1) % showcaseSlides.length;
            updateShowcase();
        });
        
        // Agregar eventos para soporte táctil
        showcaseTrack.addEventListener('touchstart', handleTouchStart, {passive: true});
        showcaseTrack.addEventListener('touchmove', handleTouchMove, {passive: true});
        showcaseTrack.addEventListener('touchend', handleTouchEnd);

        window.addEventListener('resize', updateShowcase);
        window.addEventListener('load', updateShowcase);
        updateShowcase();
        
        // Phone Overlay Logic
        const ctaButton = document.getElementById('cta-button');
        const phoneOverlay = document.getElementById('phone-overlay');
        const closeOverlayBtn = document.getElementById('close-overlay');
        const phoneForm = document.getElementById('phone-form');
        const phoneInput = document.getElementById('phone');
        const osSelection = document.getElementById('os-selection');
        const androidBtn = document.getElementById('android-btn');
        const iphoneBtn = document.getElementById('iphone-btn');
        const formFeedback = document.getElementById('form-feedback');
        const countdownContainer = document.getElementById('countdown-container');
        const countdownElement = document.getElementById('countdown');
        const doneContainer = document.getElementById('done-container');
        const doneBtn = document.getElementById('done-btn');

        // Initialize the country selector
        const iti = window.intlTelInput(phoneInput, {
            initialCountry: "es", // Default to Spain
            preferredCountries: ["es", "fr", "pt", "gb", "de"],
            separateDialCode: true,
            utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
        });
        
        // Real-time validation of phone number
        phoneInput.addEventListener('input', validatePhoneNumber);
        phoneInput.addEventListener('blur', validatePhoneNumber);
        
        // Function to validate phone number and show/hide OS selection with a positive approach
        function validatePhoneNumber() {
            if (iti.isValidNumber()) {
                // Show positive feedback when number is valid
                formFeedback.textContent = '¡Número válido!';
                formFeedback.classList.remove('error');
                formFeedback.classList.add('success');
                osSelection.classList.remove('hidden');
            } else {
                osSelection.classList.add('hidden');
                // Clear feedback while typing - only show success, not errors
                formFeedback.textContent = '';
                formFeedback.classList.remove('error', 'success');
            }
        }

        // Open the overlay when CTA button is clicked
        ctaButton.addEventListener('click', (e) => {
            e.preventDefault();
            phoneOverlay.classList.add('active');
            document.body.classList.add('no-scroll');
        });

        // Close the overlay
        closeOverlayBtn.addEventListener('click', () => {
            phoneOverlay.classList.remove('active');
            document.body.classList.remove('no-scroll');
        });

        // Close the overlay when clicking outside the content
        phoneOverlay.addEventListener('click', (e) => {
            if (e.target === phoneOverlay) {
                phoneOverlay.classList.remove('active');
                document.body.classList.remove('no-scroll');
            }
        });

        // Function to handle phone validation and SMS sending
        async function handleOSButtonClick(osType) {
            // Validate phone number
            if (!iti.isValidNumber()) {
                formFeedback.textContent = 'Por favor, introduce un número de teléfono válido';
                formFeedback.classList.add('error');
                formFeedback.classList.remove('success');
                return;
            }

            // Get the full international phone number
            const phoneNumber = iti.getNumber();
            
            // Disable both buttons during processing
            androidBtn.disabled = true;
            iphoneBtn.disabled = true;
            
            // Mostrar mensaje de envío
            formFeedback.textContent = `Enviando SMS para ${osType} al número ${phoneNumber}`;
            formFeedback.classList.remove('error');
            formFeedback.classList.add('success');
            
            try {
                // Enviar petición a nuestra función serverless
                const response = await fetch('/.netlify/functions/send-sms', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ phoneNumber, osType })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    // Si todo va bien, mostrar mensaje de éxito
                    formFeedback.textContent = `SMS para ${osType} enviado correctamente!`;
                    // Start countdown
                    startCountdown();
                    // Mostrar el botón de cerrar
                    doneContainer.classList.remove('hidden');
                } else {
                    // Si hay un error en la respuesta
                    formFeedback.textContent = `Error: ${result.error || 'No se pudo enviar el SMS'}`;
                    formFeedback.classList.remove('success');
                    formFeedback.classList.add('error');
                    // Re-habilitar los botones
                    androidBtn.disabled = false;
                    iphoneBtn.disabled = false;
                }
            } catch (error) {
                // Si hay un error en la petición
                console.error('Error al enviar el SMS:', error);
                formFeedback.textContent = 'Error de conexión. Por favor, inténtalo de nuevo.';
                formFeedback.classList.remove('success');
                formFeedback.classList.add('error');
                // Re-habilitar los botones
                androidBtn.disabled = false;
                iphoneBtn.disabled = false;
            }
        }
        
        // Handle Android button click
        androidBtn.addEventListener('click', () => {
            handleOSButtonClick('Android');
        });
        
        // Handle iPhone button click
        iphoneBtn.addEventListener('click', () => {
            handleOSButtonClick('iPhone');
        });
        
        // Prevent form submission as we now use button clicks
        phoneForm.addEventListener('submit', (e) => {
            e.preventDefault();
        });
        
        // Handle Done button click (close overlay after OS selection)
        doneBtn.addEventListener('click', () => {
            phoneOverlay.classList.remove('active');
            document.body.classList.remove('no-scroll');
            
            // Reset the form for next use
            setTimeout(() => {
                // Ocultamos el botón de cerrar y el contador
                doneContainer.classList.add('hidden');
                countdownContainer.classList.add('hidden');
                
                // Habilitamos los botones de OS para el próximo uso
                androidBtn.disabled = false;
                iphoneBtn.disabled = false;
                
                // Ocultamos la sección de OS
                osSelection.classList.add('hidden');
                
                // Limpiamos el feedback
                formFeedback.textContent = '';
                formFeedback.classList.remove('success', 'error');
            }, 300); // Pequeño delay para que no se vea el reset
        });

        // Countdown function
        function startCountdown() {
            let seconds = 59;
            countdownElement.textContent = seconds;
            countdownContainer.classList.remove('hidden');
            
            const countdownInterval = setInterval(() => {
                seconds--;
                countdownElement.textContent = seconds;
                
                if (seconds <= 0) {
                    clearInterval(countdownInterval);
                    countdownContainer.classList.add('hidden');
                    // Re-enable both OS buttons
                    androidBtn.disabled = false;
                    iphoneBtn.disabled = false;
                }
            }, 1000);
        }

        window.addEventListener('resize', updateShowcase);
        window.addEventListener('load', updateShowcase);
        updateShowcase();
        
        // Bento Grid collapsible items
        const bentoHeaders = document.querySelectorAll('.bento-header');
        
        // Add click handler for each header (making the whole area clickable)
        bentoHeaders.forEach(header => {
            header.addEventListener('click', () => {
                // Find the parent bento item
                const bentoItem = header.closest('.bento-item');
                
                // Toggle expanded state
                bentoItem.classList.toggle('expanded');
            });
        });
    </script>
</body>
</html>
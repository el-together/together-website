<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>Together.day</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Domine:wght@400..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css">
    <script>
        (() => {
            const saved = localStorage.getItem('theme');
            const theme = saved ? saved : 'dark';
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo-container">
                <img class="logo-svg" src="assets/logo.svg" alt="Together logo" width="240"/>
                <h1>Together</h1>
            </div>
            <nav class="main-nav">
                <ul class="nav-menu">
                    <li><a href="features.html" class="nav-link">Available features</a></li>
                    <li><a href="chip.html" class="nav-link">Chip &amp; AI</a></li>
                </ul>
            </nav>
            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
                <img id="icon-moon" src="assets/icon-moon.svg" alt="Dark theme" width="24" height="24" style="display: none;" />
                <img id="icon-sun" src="assets/icon-sun.svg" alt="Light theme" width="24" height="24" style="display: block;" />
            </button>
        </div>
    </header>
    
    <main>

        <section class="hero">
            <h2>Making everyday life feel easier.</h2>
            <p class="hero-text">We combine <kbd>tools</kbd> + <kbd>AI</kbd> + <kbd>collaboration</kbd> so getting things done feels simpler and more effective.</p>
            <a href="#" class="btn-cta" id="cta-button">Get the app</a>
        </section>

        <div class="bento-grid">

            <article class="bento-item bento-item-large">
                <div class="bento-header">
                    <div class="header-content">
                        <h2>What are we trying to improve?</h2>
                        <span class="chevron-icon"></span>
                    </div>
                </div>
                <div class="bento-content">
                    <p>You probably already have your calendar, your task app, another app for taking notes, and of course conversations in your favorite messenger.</p>
                    <p>When you want to pull off a simple plan, you end up coordinating several people who use tools that do not talk to each other while discussing it in an app built for chatting, not collaborating.</p>
                    <p>We are building an alternative that helps you get better outcomes when you organize everyday life.</p>
                </div>
            </article>
            
            <article class="bento-item">
                <div class="bento-header">
                    <div class="header-content">
                        <h2>Don't adapt to the product</h2>
                        <span class="chevron-icon"></span>
                    </div>
                </div>
                <div class="bento-content">
                    <p>Until now you had to hunt for products that matched your needs exactly.</p>
                    <p>We are working to flip that. Whether your days are wildly complex or refreshingly simple, the product should be the one adapting to you.</p>
                </div>
            </article> 
            
            <article class="bento-item bento-item-tall">
                <div class="bento-header">
                    <div class="header-content">
                        <h2>Collaboration is the human superpower</h2>
                        <span class="chevron-icon"></span>
                    </div>
                </div>
                <div class="bento-content">
                    <p>Working together is how we have brought every incredible thing to life.</p>
                    <p>Business day-to-day tools revolve around collaboration, yet we were missing something similar for our personal lives.</p>
                </div>
            </article> 
            
            <article class="bento-item bento-item-wide">
                <div class="bento-header">
                    <div class="header-content">
                        <h2>AI at your service</h2>
                        <span class="chevron-icon"></span>
                    </div>
                </div>
                <div class="bento-content">
                    <p>AI should serve you, not the other way around. Use it only when you want, and it will look at the data it needs to help you when you ask.</p>
                    <p>We strive to use the best models available at any moment from providers such as OpenAI, Anthropic, and Perplexity.</p>
                </div>
            </article>

            <article class="bento-item">
                <div class="bento-header">
                    <div class="header-content">
                        <h2>Free plan forever</h2>
                        <span class="chevron-icon"></span>
                    </div>
                </div>
                <div class="bento-content">
                    <p>Using Together is completely free today, and down the road you will only pay for heavy AI usage, new features, or if you go beyond limits we have not even defined yet.</p>
                </div>
            </article>
        </div>
        <section class="product-showcase">
            <button class="showcase-btn prev" id="showcasePrev" aria-label="Previous slide">&#10094;</button>
            <div class="showcase-track">
                <div class="showcase-slide active">
                    <img src="assets/homeShowcase/screen-project-1.png" alt="Projects screen" class="product-image" />
                    <div class="product-copy" style="max-width: 90%; width: 400px;">
                        <h2>Tailored to your reality</h2>
                        <p>Only you and your people know what works best to manage your life. Our mission is to give you a solution that makes it easy to live that way.</p>
                    </div>
                </div>
                <div class="showcase-slide">
                    <img src="assets/homeShowcase/screen-chat-2.png" alt="Chat screen" class="product-image" />
                    <div class="product-copy" style="max-width: 90%; width: 400px;">
                        <h2>Communication without noise</h2>
                        <p>Everything lives where it belongs. No unnecessary notifications or lost threads. Just the direct, clear communication you have always wanted.</p>
                    </div>
                </div>
                <div class="showcase-slide">
                    <img src="assets/homeShowcase/screen-cal-3.png" alt="Calendar screen" class="product-image" />
                    <div class="product-copy" style="max-width: 90%; width: 400px;">
                        <h2>Everything in its place</h2>
                        <p>No more wondering where the important info lives. Everyone knows exactly where to find each piece, making daily coordination easier.</p>
                    </div>
                </div>
            </div>
            <button class="showcase-btn next" id="showcaseNext" aria-label="Next slide">&#10095;</button>
        </section>

        <section class="principles-card">
            <div>
                <h2 class="principles-heading">We created Together to care, not to cling. To bring focus, not distraction. To offer clarity, not anxiety.</h2>
                <p class="hero-text">We have always dreamed of building something we would use with the people who matter most to us, and every design decision reflects that.</p>
                <p class="hero-text firma">- The Together founders and team</p>
            </div>
        </section>

        <!-- spaces-carousel removed -->

    </main>

    <footer>
        <div class="footer-content">
            <p class="copyright">&copy; 2025 Together Solutions S.L.</p>
            <div class="footer-links">
                <a href="legal.html" class="footer-link">Legal notice</a>
                <span class="footer-separator">·</span>
                <a href="privacy.html" class="footer-link">Privacy policy</a>
                <span class="footer-separator">·</span>
                <a href="humans.html" class="footer-link">Who's behind Together</a>
            </div>
        </div>
    </footer>

    <!-- Phone Overlay -->
    <div id="phone-overlay" class="phone-overlay">
        <div class="overlay-content">
            <button class="close-overlay" id="close-overlay">&times;</button>
            <h2>Get Together</h2>
            <p>The app is now available for Android and iOS. We will text you the direct link that matches your device.</p>
            <p>Share your phone number and we will send you the download link via SMS.</p>
            
            <form id="phone-form" class="phone-form">
                <div class="phone-input-container">
                    <input type="tel" id="phone" name="phone" class="phone-input" required>
                </div>
                <div class="form-feedback" id="form-feedback"></div>
                <div class="os-selection hidden" id="os-selection">
                    <p class="os-instruction">Choose your operating system to receive the right link:</p>
                    <div class="os-buttons">
                        <button type="button" id="android-btn" class="btn-cta os-btn">Android</button>
                        <button type="button" id="iphone-btn" class="btn-cta os-btn">iPhone</button>
                    </div>
                </div>
            </form>
            
            <div id="countdown-container" class="countdown-container hidden">
                <p>You can request another SMS in <span id="countdown">59</span> seconds</p>
            </div>
            
            <div id="done-container" class="done-container hidden">
                <button type="button" id="done-btn" class="btn-cta done-btn">Close</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <script src="js/api-config.js"></script>
    <script>
        const themeToggle = document.getElementById('theme-toggle');
        const iconMoon = document.getElementById('icon-moon');
        const iconSun = document.getElementById('icon-sun');
        
        // Check for saved theme preference or use system preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.documentElement.setAttribute('data-theme', savedTheme);
            if (savedTheme === 'dark') {
                iconMoon.style.display = 'none';
                iconSun.style.display = 'block';
            } else {
                iconMoon.style.display = 'block';
                iconSun.style.display = 'none';
            }
        }

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            if (newTheme === 'dark') {
                iconMoon.style.display = 'none';
                iconSun.style.display = 'block';
            } else {
                iconMoon.style.display = 'block';
                iconSun.style.display = 'none';
            }
        });

        // -------- Carousel logic --------
        const track = document.querySelector('#hierarchyCarousel .carousel-track');
        if (track) {
            const slides = Array.from(track.children);
            const prevBtn = document.getElementById('prevSlide');
            const nextBtn = document.getElementById('nextSlide');
            let current = 0;
            function updateCarousel() {
                track.style.transform = `translateX(-${current * 100}%)`;
            }
            prevBtn?.addEventListener('click', () => {
                current = (current - 1 + slides.length) % slides.length;
                updateCarousel();
            });
            nextBtn?.addEventListener('click', () => {
                current = (current + 1) % slides.length;
                updateCarousel();
            });
            updateCarousel();
        }

        // ----- Showcase carousel (infinite) -----
        const showcaseTrack = document.querySelector('.showcase-track');
        const showcaseSlides = document.querySelectorAll('.showcase-slide');
        const prevShowcase = document.getElementById('showcasePrev');
        const nextShowcase = document.getElementById('showcaseNext');
        const productShowcase = document.querySelector('.product-showcase');
        let showcaseCurrent = 0; // Start with the first slide
        
        // Variables to handle swipe gestures
        let touchStartX = 0;
        let touchEndX = 0;
        let isDragging = false;
        let startTranslateX = 0;
        let currentTranslateX = 0;

        function setShowcaseActive(index) {
            showcaseSlides.forEach(slide => slide.classList.remove('active'));
            showcaseSlides[index].classList.add('active');
        }

        function updateShowcase() {
            setShowcaseActive(showcaseCurrent);
            const slideWidth = showcaseSlides[0].offsetWidth; // Get width of first slide
            const gap = parseInt(window.getComputedStyle(showcaseTrack).columnGap || 16);
            const containerWidth = productShowcase.offsetWidth;
            const totalSlides = showcaseSlides.length;
            const trackWidth = (totalSlides * slideWidth) + (gap * (totalSlides - 1));
            
            let scrollPosition;
            
            // Detect whether we are on mobile or desktop
            const isMobile = window.innerWidth < 768;
            
            if (!isMobile) {
                // DESKTOP VERSION
                if (trackWidth <= containerWidth) {
                    // If the track width is narrower than the container, center the content
                    scrollPosition = (containerWidth - trackWidth) / 2;
                } else {
                    // Align the first slide to the left when it is active
                    if (showcaseCurrent === 0) {
                        scrollPosition = 0;
                    } 
                    // Align the last slide to the right when it is active
                    else if (showcaseCurrent === totalSlides - 1) {
                        scrollPosition = -(trackWidth - containerWidth);
                    } 
                    // For the rest of the slides, calculate the position to center them
                    else {
                        // Determine the spacing on each side to center the current slide
                        const slideCenter = (showcaseCurrent * (slideWidth + gap)) + (slideWidth / 2);
                        const containerCenter = containerWidth / 2;
                        
                        // Calculate the position to perfectly center the current slide
                        scrollPosition = containerCenter - slideCenter;
                        
                        // Clamp the scroll so we never exceed the bounds
                        const maxScroll = -(trackWidth - containerWidth);
                        scrollPosition = Math.max(maxScroll, Math.min(0, scrollPosition));
                    }
                }
            } else {
                // MOBILE VERSION: perfectly center every slide
                
                // Account for track padding (0.5rem on each side = 1rem total)
                const trackPadding = 16; // Equivalent to 1rem (0.5rem * 2)
                
                // Get the effective container width (minus the padding)
                const effectiveContainerWidth = containerWidth - trackPadding;
                
                // Calculate the container center (taking the padding into account)
                const containerCenter = effectiveContainerWidth / 2 + (trackPadding / 2);
                
                // Calculate the current slide center (considering the gap)
                const slideCenter = (showcaseCurrent * (slideWidth + gap)) + (slideWidth / 2);
                
                // Compute the offset needed to center the slide
                scrollPosition = containerCenter - slideCenter;
                
                // Extra fine-tuning to compensate for any visual offset
                // based on this specific DOM structure
                const fineAdjustment = 8; // Value refined after visual testing
                scrollPosition -= fineAdjustment;
            }
            
            showcaseTrack.style.transform = `translateX(${scrollPosition}px)`;
            currentTranslateX = scrollPosition;
        }
        
        // Touch handlers
        function handleTouchStart(e) {
            touchStartX = e.touches[0].clientX;
            isDragging = true;
            startTranslateX = currentTranslateX;
            showcaseTrack.style.transition = 'none'; // Disable transition while dragging
        }
        
        function handleTouchMove(e) {
            if (!isDragging) return;
            touchEndX = e.touches[0].clientX;
            const diffX = touchEndX - touchStartX;
            currentTranslateX = startTranslateX + diffX;
            showcaseTrack.style.transform = `translateX(${currentTranslateX}px)`;
            // Allow vertical scrolling while dragging
        }
        
        function handleTouchEnd() {
            if (!isDragging) return;
            isDragging = false;
            showcaseTrack.style.transition = 'transform 0.6s ease';
            
            const moveDistance = touchEndX - touchStartX;
            const threshold = window.innerWidth * 0.15; // 15% of the screen width
            
            if (moveDistance < -threshold && showcaseCurrent < showcaseSlides.length - 1) {
                // Swipe left -> next slide
                showcaseCurrent++;
            } else if (moveDistance > threshold && showcaseCurrent > 0) {
                // Swipe right -> previous slide
                showcaseCurrent--;
            }
            
            updateShowcase();
        }

        prevShowcase.addEventListener('click', () => {
            showcaseCurrent = (showcaseCurrent - 1 + showcaseSlides.length) % showcaseSlides.length;
            updateShowcase();
        });

        nextShowcase.addEventListener('click', () => {
            showcaseCurrent = (showcaseCurrent + 1) % showcaseSlides.length;
            updateShowcase();
        });
        
        // Add touch support events
        showcaseTrack.addEventListener('touchstart', handleTouchStart, {passive: true});
        showcaseTrack.addEventListener('touchmove', handleTouchMove, {passive: true});
        showcaseTrack.addEventListener('touchend', handleTouchEnd);

        window.addEventListener('resize', updateShowcase);
        window.addEventListener('load', updateShowcase);
        updateShowcase();
        
        // Phone Overlay Logic
        const ctaButton = document.getElementById('cta-button');
        const phoneOverlay = document.getElementById('phone-overlay');
        const closeOverlayBtn = document.getElementById('close-overlay');
        const phoneForm = document.getElementById('phone-form');
        const phoneInput = document.getElementById('phone');
        const osSelection = document.getElementById('os-selection');
        const androidBtn = document.getElementById('android-btn');
        const iphoneBtn = document.getElementById('iphone-btn');
        const formFeedback = document.getElementById('form-feedback');
        const countdownContainer = document.getElementById('countdown-container');
        const countdownElement = document.getElementById('countdown');
        const doneContainer = document.getElementById('done-container');
        const doneBtn = document.getElementById('done-btn');

        // Initialize the country selector
        const iti = window.intlTelInput(phoneInput, {
            initialCountry: "es", // Default to Spain
            preferredCountries: ["es", "fr", "pt", "gb", "de"],
            separateDialCode: true,
            utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
        });
        
        // Real-time validation of phone number
        phoneInput.addEventListener('input', validatePhoneNumber);
        phoneInput.addEventListener('blur', validatePhoneNumber);
        
        // Function to validate phone number and show/hide OS selection with a positive approach
        function validatePhoneNumber() {
            if (iti.isValidNumber()) {
                // Show positive feedback when number is valid
                formFeedback.textContent = 'Valid number!';
                formFeedback.classList.remove('error');
                formFeedback.classList.add('success');
                osSelection.classList.remove('hidden');
            } else {
                osSelection.classList.add('hidden');
                // Clear feedback while typing - only show success, not errors
                formFeedback.textContent = '';
                formFeedback.classList.remove('error', 'success');
            }
        }

        // Open the overlay when CTA button is clicked
        ctaButton.addEventListener('click', (e) => {
            e.preventDefault();
            phoneOverlay.classList.add('active');
            document.body.classList.add('no-scroll');
        });

        // Close the overlay
        closeOverlayBtn.addEventListener('click', () => {
            phoneOverlay.classList.remove('active');
            document.body.classList.remove('no-scroll');
        });

        // Close the overlay when clicking outside the content
        phoneOverlay.addEventListener('click', (e) => {
            if (e.target === phoneOverlay) {
                phoneOverlay.classList.remove('active');
                document.body.classList.remove('no-scroll');
            }
        });

        // Function to handle phone validation and SMS sending
        async function handleOSButtonClick(osType) {
            // Validate phone number
            if (!iti.isValidNumber()) {
                formFeedback.textContent = 'Please enter a valid phone number.';
                formFeedback.classList.add('error');
                formFeedback.classList.remove('success');
                return;
            }

            // Get the full international phone number
            const phoneNumber = iti.getNumber();
            
            // Disable both buttons during processing
            androidBtn.disabled = true;
            iphoneBtn.disabled = true;
            
            // Show sending status
            formFeedback.textContent = `Sending the ${osType} link to ${phoneNumber}...`;
            formFeedback.classList.remove('error');
            formFeedback.classList.add('success');
            
            try {
                // Use enviarSMS from api-config.js to auto-detect the environment
                const result = await enviarSMS(phoneNumber, osType);
                
                if (result.success) {
                    // Success path
                    formFeedback.textContent = `SMS for ${osType} sent successfully!`;
                    // Start countdown
                    startCountdown();
                    // Reveal the Close button
                    doneContainer.classList.remove('hidden');
                } else {
                    // Handle an error in the response
                    let errorMsg = result.error || 'Could not send the SMS';
                    
                    // Append extra details when available
                    if (result.details) {
                        errorMsg += `: ${result.details}`;
                    }
                    
                    // Log the error type when present
                    if (result.errorType) {
                        console.error(`Error type: ${result.errorType}`);
                        console.error('Full details:', result);
                    }
                    
                    formFeedback.textContent = `Error: ${errorMsg}`;
                    formFeedback.classList.remove('success');
                    formFeedback.classList.add('error');
                    // Re-enable both buttons
                    androidBtn.disabled = false;
                    iphoneBtn.disabled = false;
                }
            } catch (error) {
                // Catch network or unexpected errors
                console.error('Error sending SMS:', error);
                formFeedback.textContent = 'Connection error. Please try again.';
                formFeedback.classList.remove('success');
                formFeedback.classList.add('error');
                // Re-enable both buttons
                androidBtn.disabled = false;
                iphoneBtn.disabled = false;
            }
        }
        
        // Handle Android button click
        androidBtn.addEventListener('click', () => {
            handleOSButtonClick('Android');
        });
        
        // Handle iPhone button click
        iphoneBtn.addEventListener('click', () => {
            handleOSButtonClick('iPhone');
        });
        
        // Prevent form submission as we now use button clicks
        phoneForm.addEventListener('submit', (e) => {
            e.preventDefault();
        });
        
        // Handle Done button click (close overlay after OS selection)
        doneBtn.addEventListener('click', () => {
            phoneOverlay.classList.remove('active');
            document.body.classList.remove('no-scroll');
            
            // Reset the form for next use
            setTimeout(() => {
                // Hide the Close button and the countdown
                doneContainer.classList.add('hidden');
                countdownContainer.classList.add('hidden');
                
                // Re-enable the OS buttons for the next use
                androidBtn.disabled = false;
                iphoneBtn.disabled = false;
                
                // Hide the OS section again
                osSelection.classList.add('hidden');
                
                // Clear the feedback message
                formFeedback.textContent = '';
                formFeedback.classList.remove('success', 'error');
            }, 300); // Small delay so the reset is not visible
        });

        // Countdown function
        function startCountdown() {
            let seconds = 59;
            countdownElement.textContent = seconds;
            countdownContainer.classList.remove('hidden');
            
            const countdownInterval = setInterval(() => {
                seconds--;
                countdownElement.textContent = seconds;
                
                if (seconds <= 0) {
                    clearInterval(countdownInterval);
                    countdownContainer.classList.add('hidden');
                    // Re-enable both OS buttons
                    androidBtn.disabled = false;
                    iphoneBtn.disabled = false;
                }
            }, 1000);
        }

        window.addEventListener('resize', updateShowcase);
        window.addEventListener('load', updateShowcase);
        updateShowcase();
        
        // Bento Grid collapsible items
        const bentoHeaders = document.querySelectorAll('.bento-header');
        
        // Add click handler for each header (making the whole area clickable)
        bentoHeaders.forEach(header => {
            header.addEventListener('click', () => {
                // Find the parent bento item
                const bentoItem = header.closest('.bento-item');
                
                // Toggle expanded state
                bentoItem.classList.toggle('expanded');
            });
        });
    </script>
    <script src="js/nav-toggle.js"></script>
    <script async src="https://scripts.simpleanalyticscdn.com/latest.js"></script>
</body>
</html>
